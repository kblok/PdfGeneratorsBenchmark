EBG.declareNamespace("AdChoice");EBG.AdChoice.AdChoiceManager=function (adConfig){this._adConfig=adConfig;this._active=adConfig.adChoice.includeMarker;this._iconAdded=false;};EBG.AdChoice.AdChoiceManager.ImageData=function (){this.iconSrc="",this.id=""};EBG.AdChoice.AdChoiceManager.IabIconData={"en": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/uk/"},"de-at": { icon: "OBA_AUSTRIA.png", url: "http://www.youronlinechoices.com/at/"},"fr-be": { icon: "OBA_BELGIUM_FR.png", url: "http://www.youronlinechoices.com/be-fr/"},"nl-be": { icon: "OBA_BELGIUM_NL.png", url: "http://www.youronlinechoices.com/be-nl/"},"bg": { icon: "OBA_BULGARIA.png", url: "http://www.youronlinechoices.com/bg/"},"cs": { icon: "OBA_CZECH.png", url: "http://www.youronlinechoices.com/cs/"},"da": { icon: "OBA_DENMARK.png", url: "http://www.youronlinechoices.com/den/"},"fi": { icon: "OBA_FINLAND.png", url: "http://www.youronlinechoices.com/fi/"},"fr": { icon: "OBA_FRANCE.png", url: "http://www.youronlinechoices.com/fr/"},"de": { icon: "OBA_GERMANY.png", url: "http://www.youronlinechoices.com/de/"},"el": { icon: "OBA_GREEK.png", url: "http://www.youronlinechoices.com/gr/"},"hu": { icon: "OBA_HUNGARY.png", url: "http://www.youronlinechoices.com/hu/"},"en-ie": { icon: "OBA_IRELAND.png", url: "http://www.youronlinechoices.com/ie/"},"it": { icon: "OBA_ITALY.png", url: "http://www.youronlinechoices.com/it/"},"nl": { icon: "OBA_NETHERLANDS.png", url: "http://www.youronlinechoices.com/nl/"},"no": { icon: "OBA_NORWAY.png", url: "http://www.youronlinechoices.com/nor/"},"pl": { icon: "OBA_POLAND.png", url: "http://www.youronlinechoices.com/pl/"},"ro": { icon: "OBA_ROMANIA.png", url: "http://www.youronlinechoices.com/ro/"},"sl": { icon: "OBA_SLOVAKIA.png", url: "http://www.youronlinechoices.com/sl/"},"es": { icon: "OBA_SPAIN.png", url: "http://www.youronlinechoices.com/es/"},"sv": { icon: "OBA_SWEDEN.png", url: "http://www.youronlinechoices.com/se/"},"de-ch": { icon: "OBA_SWITZERLAND_DE.png", url: "http://www.youronlinechoices.com/ch-de/"},"fr-ch": { icon: "OBA_SWITZERLAND_FR.png", url: "http://www.youronlinechoices.com/ch-fr/"},"it-ch": { icon: "OBA_SWITZERLAND_IT.png", url: "http://www.youronlinechoices.com/ch-it/"},"en-gb": { icon: "OBA_UK.png", url: "http://www.youronlinechoices.com/uk/"},"hr": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/hr/"},"is": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/is/"},"lt": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/lt/"},"lv": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/lv/"},"pt": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/pt/"},"sk": { icon: "OBA_DEFAULT.png", url: "http://www.youronlinechoices.com/sk/"}};EBG.AdChoice.AdChoiceManager.NaiIconData={"en": { icon: "OBA_DEFAULT.png", url: "http://www.aboutads.info/consumers"}};EBG.AdChoice.AdChoiceManager.IabClosedIconName="OBA.png";EBG.AdChoice.AdChoiceManager.NaiClosedIconName="OBA.png";EBG.AdChoice.AdChoiceManager.VisibilityState={HIDDEN:"hidden", VISIBLE: "visible"};EBG.AdChoice.AdChoiceManager.Position={ABSOLUTE:"absolute", RELATIVE: "relative"};EBG.AdChoice.AdChoiceManager.ImageLoadTimeout=100;EBG.AdChoice.AdChoiceManager.DefaultOffset=-1000;EBG.AdChoice.AdChoiceManager.prototype={_imgData:null,_imgExpData:null,_iconLocalData:null,_acCloseIconName:null,_spanId:null,_iconsBaseUrl:null,_containerId:null,_assetObjId:null,init:function (){if(this._active){this._iconsBaseUrl=this._getIconsDir(this._adConfig.adChoice.iconPosition);if(this._adConfig.adChoice.certificationProgram==EBG.AcCertProgram.NAI_US){{}this._iconLocalData=this._getIconDataByLanguage(EBG.AdChoice.AdChoiceManager.NaiIconData);this._acCloseIconName=EBG.AdChoice.AdChoiceManager.NaiClosedIconName;}else{this._iconLocalData=this._getIconDataByLanguage(EBG.AdChoice.AdChoiceManager.IabIconData);this._acCloseIconName=EBG.AdChoice.AdChoiceManager.IabClosedIconName;}var events=EBG.eventMgr.getDispatchedEvents({name:EBG.Events.EventNames.ADD_CREATIVES,eventTiming:EBG.Events.EventTiming.AFTER});if(events){for(var i=0;i<events.length;i++){if(events[i].eventData&&!events[i].eventData.isPanel&&events[i].dispatcher&&events[i].dispatcher._adConfig&&events[i].dispatcher._adConfig.uid==this._adConfig.uid){this._assetObjId=events[i].eventData.assetId;this._handleAdChoice(events[i]);}}}var sub=new EBG.Events.EventSubscription(EBG.Events.EventNames.ADD_CREATIVES,this._handleAdChoice,this);sub.timing=EBG.Events.EventTiming.AFTER;sub.dispatcherFilters={"_adConfig.rnd":this._adConfig.rnd};EBG.eventMgr.subscribeToEvent(sub);var sub=new EBG.Events.EventSubscription(EBG.Events.EventNames.ADD_BANNER_DEFAULT_IMAGE_CREATIVE,this._handleAdChoice,this);sub.timing=EBG.Events.EventTiming.AFTER;sub.dispatcherFilters={"_adConfig.rnd":this._adConfig.rnd};EBG.eventMgr.subscribeToEvent(sub);var sub=new EBG.Events.EventSubscription(EBG.Events.EventNames.ADD_BANNER_DEFAULT_FLASH_CREATIVE,this._handleAdChoice,this);sub.timing=EBG.Events.EventTiming.AFTER;sub.dispatcherFilters={"_adConfig.rnd":this._adConfig.rnd};EBG.eventMgr.subscribeToEvent(sub);EBG.eventMgr.subscribeToEvent(new EBG.Events.EventSubscription(EBG.Events.EventNames.PAGE_RESIZE,this._pageResizeHandler,this));}else{}},_handleAdChoice:function (event){if(event.eventData&&!event.eventData.isPanel){this._assetObjId=event.eventData.assetId;}if(!this._iconAdded){this._iconAdded=true;this._containerId=this._adConfig.placeHolderId;this._imgData=this._getImageData();this._imgExpData=this._getExpImageData();var onClickUrl=this._getAdChoiceUrl();this._addAdChoiceIcons(this._imgData,this._imgExpData,onClickUrl);this._subscribeIconToEvents(this._imgData.id,this._imgExpData.id);}else{var adElmnt=EBG.adaptor.getElementById(this._containerId);var spanElmnt=EBG.adaptor.getElementById(this._spanId);EBG.adaptor.removeElement(spanElmnt);EBG.adaptor.appendChildElement(adElmnt.id,spanElmnt);}},hide:function (){var img=EBG.adaptor.getElementById(this._imgData.id);var imgExp=EBG.adaptor.getElementById(this._imgExpData.id);if(img){img.style.visibility="hidden";}if(imgExp){imgExp.style.visibility="hidden";}},show:function (){var img=EBG.adaptor.getElementById(this._imgData.id);var imgExp=EBG.adaptor.getElementById(this._imgExpData.id);if(img){img.style.visibility="visible";}if(imgExp){imgExp.style.visibility="hidden";}},_getImageData:function (){var imgData=new EBG.AdChoice.AdChoiceManager.ImageData();imgData.iconSrc=this._iconsBaseUrl+this._acCloseIconName;imgData.id="acImage_"+this._adConfig.uid;return imgData;},_getExpImageData:function (){var imgData=new EBG.AdChoice.AdChoiceManager.ImageData();imgData.iconSrc=this._iconsBaseUrl+this._iconLocalData.icon;imgData.id="acExpImage_"+this._adConfig.uid;return imgData;},_getAdChoiceUrl:function (){var url="";if(this._adConfig.adChoice.customUrl){url=unescape(this._adConfig.adChoice.customUrl);}else{url=this._iconLocalData.url;}return url;},_getIconDataByLanguage:function (languagesTable){var language=EBG.adaptor.getBrowserLanguage().toLowerCase();var acData=languagesTable[language];if(!acData){var langPrefix=language.split("-")[0];acData=languagesTable[langPrefix];}if(!acData){{}acData=languagesTable["en"];}return acData;},_getIconOffsets:function (imgId,iconPosition,iconLength,iconHeight,adLength,adHeight){var pos={offsetLeft:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset),offsetTop:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset)};if(this._assetObjId){adPos=EBG.adaptor.getPositioningById(this._assetObjId,true,this._adConfig.actualServingMode);if(adPos){{}if(!adLength||!adHeight){var elem=EBG.adaptor.getElementById(this._assetObjId);var rect=EBG.adaptor.getBoundingClientRect(elem);adLength=adLength?adLength:rect.width;adHeight=adHeight?adHeight:rect.height;}acPos=EBG.adaptor.getPositioningById(imgId,true,this._adConfig.actualServingMode);var imgStyle=EBG.adaptor.getStyleOfElem(EBG.adaptor.getElementById(imgId));var baseLeft=parseInt(imgStyle['left'])+adPos.X-acPos.X;var baseTop=parseInt(imgStyle['top'])+adPos.Y-acPos.Y;switch(iconPosition){case EBG.AcIconPosition.BottomLeft:pos.offsetLeft=EBG.px(baseLeft);pos.offsetTop=EBG.px(baseTop+adHeight-iconHeight);break;case EBG.AcIconPosition.BottomRight:pos.offsetLeft=EBG.px(baseLeft+adLength-iconLength);pos.offsetTop=EBG.px(baseTop+adHeight-iconHeight);break;case EBG.AcIconPosition.TopLeft:pos.offsetLeft=EBG.px(baseLeft);pos.offsetTop=EBG.px(baseTop);break;case EBG.AcIconPosition.TopRight:pos.offsetLeft=EBG.px(baseLeft+adLength-iconLength);pos.offsetTop=EBG.px(baseTop);break;};}}return pos;},_getIconsDir:function (iconPosition){var iconDir=this._adConfig.imagesDir+"/AdChoice/";switch(iconPosition){case EBG.AcIconPosition.BottomLeft:iconDir+="BottomLeft/";break;case EBG.AcIconPosition.BottomRight:iconDir+="BottomRight/";break;case EBG.AcIconPosition.TopLeft:iconDir+="TopLeft/";break;case EBG.AcIconPosition.TopRight:iconDir+="TopRight/";break;};return iconDir;},_addAdChoiceIcons:function (acImg,acImgExp,onClickUrl){var aId="acImgLinkWrapper_"+this._adConfig.uid;this._spanId="acSpan_"+this._adConfig.uid;var adElmnt=EBG.adaptor.getElementById(this._containerId);if(adElmnt){var spanObj={tagName:EBG.Adaptors.TagNames.DIV,attributes:{id:this._spanId,style:{position:EBG.AdChoice.AdChoiceManager.Position.ABSOLUTE,zIndex:EBG.adaptor.getMaxZIndex(adElmnt)+1}},children:[{tagName:EBG.Adaptors.TagNames.A,attributes:{id:aId,target:"_blank",onClick:EBG.format("EBG.adaptor.openPage('{0}');",onClickUrl),mmskipreplace:1},children:null}]};if(this._containerId==this._adConfig.placeHolderId){EBG.adaptor.inject(spanObj,EBG.Adaptors.InjectionMethod.APPEND,adElmnt);}else{EBG.adaptor.inject(spanObj,EBG.Adaptors.InjectionMethod.INSERT_BEFORE,adElmnt);}var aElmnt=EBG.adaptor.getElementById(aId);if(aElmnt){var imgObj={tagName:EBG.Adaptors.TagNames.IMG,attributes:{id:acImg.id,style:{position:EBG.AdChoice.AdChoiceManager.Position.ABSOLUTE,visibility:EBG.AdChoice.AdChoiceManager.VisibilityState.VISIBLE,left:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset),top:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset)}},children:null};EBG.adaptor.inject(imgObj,EBG.Adaptors.InjectionMethod.APPEND,aElmnt);var expImgObj={tagName:EBG.Adaptors.TagNames.IMG,attributes:{id:acImgExp.id,style:{position:EBG.AdChoice.AdChoiceManager.Position.ABSOLUTE,visibility:EBG.AdChoice.AdChoiceManager.VisibilityState.HIDDEN,left:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset),top:EBG.px(EBG.AdChoice.AdChoiceManager.DefaultOffset)}},children:null};EBG.adaptor.inject(expImgObj,EBG.Adaptors.InjectionMethod.APPEND,aElmnt);var imageDefault=EBG.adaptor.getElementById(acImg.id);var imageExpanded=EBG.adaptor.getElementById(acImgExp.id);var $this=this;var imgHandler=function (){EBG.runTimed($this,$this._handleImgOnloadEvent,[acImg.id,0],EBG.AdChoice.AdChoiceManager.ImageLoadTimeout);};var expHandler=function (){EBG.runTimed($this,$this._handleImgOnloadEvent,[acImgExp.id,0],EBG.AdChoice.AdChoiceManager.ImageLoadTimeout);};if(imageDefault){var sub=new EBG.Events.EventSubscription("load",imgHandler,this);sub.isElementEvent=true;sub.elementId=acImg.id;EBG.eventMgr.subscribeToEvent(sub);imageDefault.src=acImg.iconSrc;}if(imageExpanded){var sub=new EBG.Events.EventSubscription("load",expHandler,this);sub.isElementEvent=true;sub.elementId=acImgExp.id;EBG.eventMgr.subscribeToEvent(sub);imageExpanded.src=acImgExp.iconSrc;}}}},_subscribeIconToEvents:function (imgId,imgExpId){var $this=this;var handler=function (){$this._handleMouseOverEvent(imgId,imgExpId);};var sub=new EBG.Events.EventSubscription("mouseover",handler,this);sub.isElementEvent=true;sub.elementId=imgId;EBG.eventMgr.subscribeToEvent(sub);sub=new EBG.Events.EventSubscription("mouseout",handler,this);sub.isElementEvent=true;sub.elementId=imgExpId;EBG.eventMgr.subscribeToEvent(sub);},_handleMouseOverEvent:function (imgId,imgExpId){var img=EBG.adaptor.getElementById(imgId);var expImg=EBG.adaptor.getElementById(imgExpId);var imgStyle=EBG.adaptor.getStyleOfElem(img);var imgVis=EBG.AdChoice.AdChoiceManager.VisibilityState.VISIBLE;var expVis=EBG.AdChoice.AdChoiceManager.VisibilityState.HIDDEN;if(imgStyle['visibility']==EBG.AdChoice.AdChoiceManager.VisibilityState.VISIBLE){var imgVis=EBG.AdChoice.AdChoiceManager.VisibilityState.HIDDEN;var expVis=EBG.AdChoice.AdChoiceManager.VisibilityState.VISIBLE;}var imgElmntStyle={visibility:imgVis};var expElmntStyle={visibility:expVis};EBG.adaptor.setStyleToElem(img,imgElmntStyle);EBG.adaptor.setStyleToElem(expImg,expElmntStyle);},_pageResizeHandler:function (){this._handleImgOnloadEvent(this._imgData.id,0);this._handleImgOnloadEvent(this._imgExpData.id,0);},_handleImgOnloadEvent:function (imgId,tryNum){var img=EBG.adaptor.getElementById(imgId);imgPos=this._getIconOffsets(imgId,this._adConfig.adChoice.iconPosition,img.width,img.height,this._adConfig.width,this._adConfig.height);if(EBGInfra.isDefinedNotNull(tryNum)&&tryNum<10){{}EBG.runTimed(this,this._rehandleImgOnloadEvent,[imgId,tryNum],EBG.AdChoice.AdChoiceManager.ImageLoadTimeout);return;}var imgElmntStyle={left:imgPos.offsetLeft,top:imgPos.offsetTop};EBG.adaptor.setStyleToElem(img,imgElmntStyle);},_rehandleImgOnloadEvent:function (imgId,tryNum){this._handleImgOnloadEvent(imgId,tryNum+1);}};